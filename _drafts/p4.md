---
layout: post
title: Perforce
---

Until now, I've only really used distributed version control software; [Mercurial](http://mercurial.selenic.com) in college and
[Git](http://git-scm.com) since I got a Github account.  I started working at Cisco and started using
[Perforce](http://www.perforce.com/).  It's been a little weird, but I think I'm getting the hang of it.

## My Environment ##

I set Perforce's `P4CONFIG` variable in my `.bashrc` to let me put a config file at the root of each of my Perforce
repositories.  This let's me easily change my server, username, client, etc. for each repository.
At work I like to have a client for each branch we work on; this lets me do just that.

My Perforce settings in my `.bashrc`

```bash
# Perforce
export P4CONFIG=.p4config
export P4IGNORE=.p4ignore
export P4EDITOR=vim
```

You might have noticed the `P4IGNORE` variable in my `.bashrc`.

`P4IGNORE` files work just like `.gitignore`.

One of my `.p4config` file

```bash
P4PORT=workshop.perforce.com:1666
P4USER=zachwhaley
P4CLIENT=p4_completion
```


## Bash Completion ##

The bash completion in Git is really convenient, but unfortunately Perforce's CLI program, `p4`, doesn't come with a bash
completion script.  So I made my [own](https://github.com/zachwhaley/p4_completion).  As of now, I'm attempting to move
the code to a [Perforce repository](https://swarm.workshop.perforce.com/projects/p4-completion).

## Distributing Perforce ##

Perforce is not a distributed version control system, but there are ways to make it seem like it is.

### Write All the Files! ###

So the Perforce settings at my work force all local files to be readonly by default.  I feel like this hinders my
programming flow and is just unecessary.  So I changed it.

The option to make all files writeable is in your Perforce client, which can be viewed with the following command.

```bash
$ p4 client
```

This will open your client settings in an editor to be view and changed.  If you don't like the default editor you can change this
by setting the Perforce variable P4EEDITOR in your bash environment, like below.  This can also be set in your `.bashrc`
like I did above.

```bash
$ export P4EDITOR=gedit
$ p4 client
```

In the client settings, change the Option **noallwrite** to **allwrite**, and save the file.

```
# A Perforce Client Specification.
# ...
# A bunch of stuff is here

Client:	p4_completion

Update:	2014/04/07 15:32:56

Access:	2014/04/07 19:57:03

Owner:	zachwhaley

Host:	work-lenovo

Description:
	Created by zachwhaley.

Root:	/home/zwhaley/code/p4_completion

Options:	allwrite noclobber nocompress unlocked nomodtime normdir

SubmitOptions:	submitunchanged

LineEnd:	local

View:
	//guest/zachwhaley/p4_completion/... //p4_completion/...
```

This will save the client settings, but your files won't become writeable just yet.


Perform a `p4 sync` To update all your repos files permissions with the following command

```bash
# Make sure any uncomitted changes to the repo are saved off somehow,
# before executing the next step.
$ p4 sync -f
```

You can now change any file you want!  But what happens when It's time to commit a change?

### Reconcile with Lord Server ###

After I've made my changes to the code (for better or worse), I'll run `p4 status`.  Just like Git, this command tells you
what has been modified , added, or deleted from the server's code base.

```bash
$ p4 status
bar.cpp - reconcile to add //guest/zachwhaley/project/bar.cpp#1
bar.hpp - reconcile to add //guest/zachwhaley/project/bar.hpp#1
foo.cpp - reconcile to edit //guest/zachwhaley/project/foo.cpp#2
```

But this doesn't know how things have been modified.  I still have to tell the Lord Server which files I want to change.
Since I'm happy with the files listed, it is time to reconcile with Lord Server and tell them what we have done.

```bash
$ p4 reconcile
//guest/zachwhaley/project/bar.cpp#1 - opened for add
//guest/zachwhaley/project/bar.hpp#1 - opened for add
//guest/zachwhaley/project/foo.cpp#2 - opened for edit
```

Now I can do things like diff files and create changes for submission.
